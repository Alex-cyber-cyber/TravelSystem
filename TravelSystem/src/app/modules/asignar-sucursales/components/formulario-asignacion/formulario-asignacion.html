<div class="assignment-dialog" [class.dark-mode]="darkMode">
  <div class="dialog-header">
    <div class="header-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm4 12h-4v3l-5-5 5-5v3h4v4z"/>
      </svg>
    </div>
    <h2 class="dialog-title">Asignaci贸n de Sucursal</h2>
    <p class="dialog-subtitle">Complete los detalles para asignar la sucursal</p>
  </div>
  <div class="dialog-content">
    <form [formGroup]="asignacionForm" class="assignment-form" (ngSubmit)="guardar()">
      <div class="form-section">
        <label class="section-label">
          <span>Colaborador</span>
          <span class="required-mark">*</span>
        </label>
        <ng-select
          [items]="personalList"
          bindLabel="nombres"
          bindValue="_id"
          [searchable]="true"
          [clearable]="false"
          placeholder="Seleccione un colaborador..."
          formControlName="personal_id"
          class="premium-select"
          [ngClass]="{'input-invalid': (asignacionForm.get('personal_id')?.invalid && (asignacionForm.get('personal_id')?.touched || formSubmitted))}"
          (focus)="onFocus('personal')"
          (search)="onSearch($event, 'personal')">
          
          <ng-template ng-option-tmp let-item="item">
            <div class="select-item">
              <div class="item-avatar" [style.background]="getRandomColor(item.nombres)">
                {{ item.nombres?.charAt(0) | uppercase }}
              </div>
              <div class="item-details">
                <div class="item-title">{{ item.nombres }}</div>
                <div class="item-subtitle">ID: {{ item.idEmpleado }}</div>
              </div>
            </div>
          </ng-template>
          
          <ng-template ng-notfound-tmp>
            <div class="not-found-message">No se encontraron colaboradores</div>
          </ng-template>
        </ng-select>
        
        <div *ngIf="asignacionForm.get('personal_id')?.invalid && (asignacionForm.get('personal_id')?.touched || formSubmitted)" 
             class="error-message">
          {{ getErrorMessage('personal_id') }}
        </div>
      </div>

      <div class="form-section">
        <label class="section-label">
          <span>Sucursal</span>
          <span class="required-mark">*</span>
        </label>
        <ng-select
          [items]="sucursalList"
          bindLabel="name"
          bindValue="_id"
          [searchable]="true"
          [clearable]="false"
          placeholder="Seleccione una sucursal..."
          formControlName="sucursal_id"
          class="premium-select"
          [ngClass]="{'input-invalid': asignacionForm.get('sucursal_id')?.invalid && (asignacionForm.get('sucursal_id')?.touched || formSubmitted)}"
          (focus)="onFocus('sucursal')"
          (search)="onSearch($event, 'sucursal')">
          
          <ng-template ng-option-tmp let-item="item">
            <div class="select-item">
              <div class="store-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5 8h14V6H5v2zm15-4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V10h16v8zm0-10H4V6h16v2zM7 15h6v2H7z"/>
                </svg>
              </div>
              <div class="item-details">
                <div class="item-title">{{ item.name }}</div>
                <div class="item-subtitle">C贸digo: {{ item.code }}</div>
              </div>
            </div>
          </ng-template>
          
          <ng-template ng-notfound-tmp>
            <div class="not-found-message">No se encontraron sucursales</div>
          </ng-template>
        </ng-select>

        <div *ngIf="asignacionForm.get('sucursal_id')?.invalid && (asignacionForm.get('sucursal_id')?.touched || formSubmitted)" class="error-message">
          {{ getErrorMessage('sucursal_id') }}
        </div>
      </div>

      <div class="form-section">
        <label class="section-label">
          <span>Distancia (km)</span>
          <span class="required-mark">*</span>
        </label>
        <div class="input-container">
          <input
            type="number"
            class="premium-input"
            formControlName="distancia_km"
            placeholder="1.00"
            step="1"
            min="1"
            max="50"
            (input)="validarDistancia()"
            [ngClass]="{'input-invalid': (asignacionForm.get('distancia_km')?.invalid && (asignacionForm.get('distancia_km')?.touched || formSubmitted))}">
          <span class="input-unit">km</span>
        </div>
        <div class="input-hint">Distancia debe ser entre 1 y 50 km</div>

        <div *ngIf="asignacionForm.get('distancia_km')?.invalid && (asignacionForm.get('distancia_km')?.touched || formSubmitted)" 
             class="error-message">
          {{ getErrorMessage('distancia_km') }}
        </div>
      </div>

      <div class="error-container" *ngIf="showError">
        <div class="error-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
        </div>
        <div class="error-content">
          <div class="error-title">Error en asignaci贸n</div>
          <div class="error-message">{{ errorMessage }}</div>
        </div>
      </div>

      <div class="action-buttons">
        <button type="button" class="dialog-btn secondary-btn" (click)="cerrar()" [disabled]="loading">
          Cancelar
        </button>
        <button type="submit" class="dialog-btn primary-btn" [disabled]="loading">
          <span class="btn-spinner" *ngIf="loading"></span>
          <span>{{ loading ? 'Guardando...' : 'Guardar Asignaci贸n' }}</span>
        </button>
      </div>
    </form>
  </div>
</div>